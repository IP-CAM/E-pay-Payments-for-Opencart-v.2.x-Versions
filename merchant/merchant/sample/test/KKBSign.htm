<HTML>
<HEAD>
<META NAME="GENERATOR" Content="Microsoft FrontPage 5.0">
<TITLE></TITLE>
</HEAD>
<BODY>
<H1 align=center>Инструкция </H1>
<H3 align=center>по работе с модулем электронной подписи </H3>
<H3 align=center>KKBSign</H3>
<P>Модуль KKBSign разработан для использования в системах электронной коммерции 
(магазинах) на платформах, отличных от MS Windows. Модуль применяется для 
создания электронной подписи документа-заказа на сервере продавца, и для 
проверки подписи документа-подтверждения от банка. </P>
<P>Модуль разработан в среде SUN Java SDK версии 1.3.0 и JSSE версии 1.0.2 (для 
обеспечения работы с RSA алгоритмом) </P>
<H4 align=center><U>Описание интерфейса:</U> </H4>
<P>public String <b>build64</b>(String <b>config_file</b>, String <b>amount</b>, 
String <b>order_id</b>)</P>
<P><span lang="ru">Выполняет полное построение заказа по указанным сумме и 
номеру заказа, устанавливает переменные в соответствии с файлом конфигурации, 
подписывает и кодирует в </span>base64.</P>
<P>public String <STRONG>sign64</STRONG>(String 
<STRONG>text</STRONG>, String <STRONG>keystore</STRONG>, String 
<STRONG>alias</STRONG>, String <STRONG>keypass</STRONG>, String 
<STRONG>storepass</STRONG>         
  ) </P>
<P>Осуществляет подпись 
текста text секретным ключом, взятым из файла хранилища keystore. Для доступа к 
ключу необходимо указать пароль на ключ keypass и пароль на хранилище storepass. 
Возвращает закодированную по base64 подпись, пригодную для вставки в документ 
(внутри тега <MERCHANT_SIGN>) </P>
<P>public boolean <STRONG>verify</STRONG>(String 
<STRONG>text</STRONG>,String <STRONG>signature64</STRONG>, String 
<STRONG>keystore</STRONG>, String <STRONG>alias</STRONG>, String 
<STRONG>storepass</STRONG>        
  ) </P>
<P>Осуществляет проверку текста text с подписью signature64 с 
помощью публичного ключа, взятого из файла хранилища keystore. Для доступа 
к ключу необходимо указать пароль на хранилище storepass. Возвращает true если подпись 
верна и false в противном случае.</P>
<P align=left><STRONG><U>Дополнительные свойства 
модуля:</U></STRONG>   </P>
<P>public String <STRONG>keystoretype </STRONG>   </P>
<P>Тип файла-хранилища ключей. По умолчанию "JKS" </P>
<P>public String <STRONG>signalgorythm </STRONG>   </P>
<P>Тип алгоритма для подписи и проверки. По умолчанию "SHA1withRSA" </P>
<P>public boolean <STRONG>invert</STRONG>   </P>
<P>Флаг, указывающий на необходимость перестановки байт в подписи, введен для 
обеспечения совместимости с Windows. По умолчанию true, то есть перестановка 
производится. </P>
<P>public boolean <STRONG>debug </STRONG>   </P>
<P>Управляет выводом на экран значения хеш-функции. По умолчанию false, то есть 
не выдается. </P>
<P>public String <STRONG>debughash</STRONG>          </P>
<P>Тип хеш-функции для отладки. По умолчанию "SHA". </P>
<H4 align=center><U>Как получить и установить сертификат 
для подписи. </U>       </H4>
<p align=justify><span lang="ru">Как правило мы предоставляем готовое хранилище 
ключей (</span>java keystore). <span lang="ru">Если возникнет необходимость его 
собрать самостоятельно, используйие следующую технику:</span></p>
<p>1. Установите SUN Java SDK версии 1.3 или выше (возможно 
система будет работать и на версии 1.2.х, но тестирование на ней не проводилось) 
</p>
<P><span lang="ru">2</span>. Получите от банка набор файлов : </P>
<UL>
  <LI>
  <DIV>newkey.pk8 - секретный ключ в формате PKCS#8 </DIV></LI>
  <LI>newcert.der - сертификат, соответсвующий секретному ключу в формате DER 
  </LI>
  <LI>
  <DIV>kkbca.der - корневой сертификат банка (опционально) </DIV></LI></UL>
<P><span lang="ru">3</span>. Поместите все файлы в один каталог и запустите команду импорта: </P>
<P align=center><EM>java DERImport keystore.jks shopalias 
newkey.pk8 newcert.der kkbca.der </EM>       </P>
<P align=center>где : </P>
<UL>
  <LI>
  <DIV>DERImport - программа импорта ключей. Должна быть в текущем каталоге как 
  и файлы ключей и сертификатов. </DIV></LI>
  <LI>
  <DIV>keystore.jks - имя файла-хранилища для ключей и сертификатов. Если такого 
  файла нет, он будет создан заново. </DIV></LI>
  <LI>
  <DIV>Shopalias - короткое имя, присваиваемое секретному ключу и сертификату. 
  </DIV></LI></UL>
<P>В процессе выполнения команды Вам будет предложено ввести пароли для доступа 
к хранилищу и секретному ключу. </P>
<P><span lang="ru">4</span>. Не забудьте , что файл newkey.pk8 является конфиденциальной информацией, 
не оставляйте его в доступном каталоге. Вместе с тем рекомендуется также 
сохранить его на дискете в безопасном месте на случай утери хранилища. </P>
<H4 align=center><U>Примеры для тестирования</U> </H4>
<P><STRONG>Signtest.java</STRONG> - тест подписи документа </P>
<P><STRONG>Verifytest.java</STRONG> - тест проверки подписи документа </P>
<P>В этих утилитах подпись формируется и проверяется в виде отдельного файла, 
вставка подписи в документ и извлечение из документа может производиться 
скриптом.</P>
<P>
<HR>
</P>

</BODY>
</HTML>