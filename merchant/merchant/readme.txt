kkbsign_java   - Модуль и документация
HELP - Документация: схема работы Системы, Описание полей и форматы передааемых документов
sample - пример на ASP, JSP платежной страницы и PostLink страницы
Test_ser_all - тестовые сертификаты в разных форматах
paysystem_PHP - Пример и модуль подписи/проверки подписи реализованные на PHP
pay_PHP - еще один Пример и модуль подписи/проверки подписи реализованные на PHP


		I. Подключение


1. Заключается договор на обслуживание системой e-pay в центральном офисе,
т.е.
у нас в Алматы.  Подключение бесплатное.

Карточки к оплате принимаются в любой валюте и любых банков, но зачисление денег происходит только в
тенге(законодательство РК) конвертируется по внутреннему курсу Визы и
МастерКарда, примерно соостветствует курсу Нац банка


2. Заводиться терминал в карточной системе
3. Заводиться Продавец в Системе епей.
4. Продавецу высылается Сертификат (файл .jks) и Модуль для подписи сообщений и проверки банковских подписей.
файле .jks (собран с помощью OpenSSL) содержит Ваш Приватный и Публичный
ключи, а также наш Публичный ключ.
Публичный банковский ключ - алиас всегда "kkbca".
Публичный и Приватный магазина, для каждого магазина свой алиас,
для тестового магазина алиас - "cert"


5. Продавец встраивает модуль в свой магазин и начинает работать

		II. Возможности Сисемы:

- Прием платежей в любой валюте, с возможностью 3DSecure или SecureCode авторизацией.
- Отмена или подтверждение авторизации Мерчантом выполняется в ручном или автоматическом режимах.
- Различные отчеты: Выписки, Подтвержденные, Отмененные, Ожидающие подтверждения авторизации

		III. Алгоритм работы магазина такой:

1.Клиент приходит в магазин выбирает список товаров
2.Вы подсчитываете сумму
3.Собирается пакет: Номер ордера, Общая сумма, валюта, ID магазина, URL для
ответа и еще несколько параметров . Все это подписывается Сертификатом, кодируется в base64 и
делается редирект на сайт Банка с приложенным пакетом.
4.Клиент поизводит оплату карточкой на сайте Банка
5.Банк извещает Вас по e-mail и URL ответа о произведенной оплате
6.Вы осуществляете доставку товара.
Желательно, чтоб Клиент расписывался в Ваших в накладных о получении
товара. Это нужно только Вам, чтобы доказать, что Вы свои обязательства
выполнили. Иначе Клиент может выставить претензию в банк, что не получал
товар, и нам придется удержать с Вас эту сумму!
7.Вы подтверждаете на сайте банка эту транзакцию
8.Банк зачисляет на Ваш счет полученные деньги.
9.Согласно тарифам, с Вашего счета будет удержанна комиссия по всем
законченным транзакциям

		IV. Алгоритм подключения сайта магазина к платежной системе Банка:

1. Создать корзину покупок для Клиента (Это у Вас наверно уже есть, если нет сделать)
    - присвоить уникальный номер счета оплаты (Order) не менее 6ти знаков цифровой
2. Создание платежной формы на сайте
    - пример pay.asp приложен.
    - PaymentSetup.rar - Документация по обязательным и необязательным полям формы
    - эта форма должна методом POST отправлять Клиента на платежный сервер Банка
3. Получение ответа от Банка об удачных платежах
    - по e-mail 
    - на PostLink магазина.
    Вам необходимо создать страницу PostLink, которая будет получать также методом POST от банка подписанный XML документ.
4. Создание Системы автоматического подтверждения (отмены) платежей. (Не обязательно)

		V. Требования к программному обеспечению.

Задачи модуля KKBSign :
- создать пакет (см. III.п.3 выше). 
- подписать строку сертификатом (сертификат ханится в файле .jks)
- проверить подпись банка в полученом сообщении

ПРИМЕЧАНИЯ:
Приложения: Документация, Модули, Примеры высылаются только после рассмотрения Вашего проекта и предварительного согласия на подключение с нашей стороны



		VI. Советы

На стороне магазина необходимо создать Интерфейс с банком, это минимум 2 странички.
Описания полей в документе HELP/PaymentSetup.chm 

- первая платежная, пример:  pay.jsp(asp) или pay.jsp

эта страница (pay.*) содержит несколько скрытых полей, урл банка 
урл Вашего PostLink.* модуля, еще несколько полей и кнопку "оплатить" для Клиента
Как сформировать одно из полей (name="Signed_Order_B64"), используя модуль подписи KKBSign.jar расписано ниже
На PHP реализация возможна без java и модуля KKBSign.jar. Пример тут: paysystem_PHP 


- вторая страничка PostLink, по приему подтверждений об оплатах от банка, пример: pl.jsp 

Эта страница PostLink.*, которая будет получать также методом POST от банка подписанную XML строку.
Тут необходимо разобрать эту строку, проверить на подпись банка, затем сопоставить номер ордера и выставить флажок "оплачено" в Своей Системе(магазине)
В ответ банку надо вернуть 0 или 1 БЕЗ ТЕГОВ!!!
расписано тоже ниже


---------------

Правило:
Order_id это уникальное числовое значение. Повторяться не должны!!!

Разрабатывая Систему учтите один нюанс в checkOrdern.jsp.

Допустим в 14м году у Вас нумерация идет с 1 до 1000
Допустим заказ 555 оплачен успешно!  Чек ордер Вам покажет успешность транзакции

Теперь, например в 15м году у Вас произойдет сбой системы и Вы начнете отсчет заново с 1
Естественно что отправив запрос на оплату с номером 555 мы его не пропустим,т.к. он был оплачен ранее
Отправив запрос нам на чекордере merchant_id + Order_id, мы естественно ответим, что заказ оплачен успешно!

Обязательно анализируйте поле timestamp в ответе!!! 


